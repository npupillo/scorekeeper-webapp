"use strict";var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},router=function(a){a.host="http://localhost:3000";var b=Backbone.Router.extend({routes:{"":"allGames",game:"showGame",newgame:"newGame",players:"allPlayers"},allGames:function(){c(),$("#content1").load("partials/allGames.html"),allGames.init()},showGame:function(a){c(),$("#content1").load("partials/showGame.html"),showGame.init(a)},newGame:function(){$("#content1").load("partials/newGame.html"),newGame.init()},allPlayers:function(){c(),$("#content1").load("partials/allPlayers.html"),allPlayers.init()}}),c=function(){$("#content1").empty(),$("#content2").empty(),$("#content3").empty()};return a.router=new b,a.backbone=function(){Backbone.history.start()},a}(router||{});$(document).ready(function(){router.backbone()}),Handlebars.registerHelper("handlebar_helper",function(){return"This is the output of your helper method."}),Handlebars.registerHelper("multiply",function(a,b){return a*b}),Handlebars.registerHelper("add_nums",function(a,b){for(var c=0,d=0;d<a.length;d++)c+=b.fn(a[d]);return c}),Handlebars.registerHelper("grouped_each",function(a,b,c){var d,e="",f=[];if(b&&b.length>0){for(d=0;d<b.length;d++)d>0&&d%a===0&&(e+=c.fn(f),f=[]),f.push(b[d]);e+=c.fn(f)}return e}),Handlebars.registerHelper("sum",function(){for(var a,b=0,c=0;c<arguments.length;c++)a=parseFloat(arguments[c]),isNaN(a)||(b+=a);return b}),Handlebars.registerHelper("getGameplayerId",function(a,b){return a[b]});var showGame=function(a){var b=function(a){var b=a.players;b.forEach(function(b){b.scores.forEach(function(b,c,d){b.game_id!==a.id&&d.splice(c,1)})}),c(a),e(a)},c=function(a){var b=Handlebars.compile($("#one_game_template").html());$("#content1").html(b({game:a})),$("form.points-form").on("submit",function(a){a.preventDefault(),d(a)})},d=function(a){a.preventDefault();var b=$("#input-field");console.log("field value: "+b.val())},e=function(a){var b=a.players,c=[];b.forEach(function(a){var b=(a.scores,0);a.scores.forEach(function(a,c,d){b+=a.points}),c.push(b)}),f(c),g(c)},f=function(a){console.log("game_scores: "),console.log(a),$("#chart_hc").highcharts({chart:{type:"column"},title:{text:"Game Scores"},xAxis:{title:{text:"Players"}},yAxis:{title:{text:"Score Totals"}},plotOptions:{series:{dataLabels:{enabled:!0}}},series:[{name:"Game Scores",colorByPoint:!0,data:a}]})},g=function(a){var b,c=a,d={top:10,right:10,bottom:10,left:10},e=400-d.top-d.bottom,f=600-d.left-d.right,g=d3.scale.linear().domain([0,.33*c.length,.66*c.length,c.length]).range(["#B58929","#C61C6F","#268BD2","#85992C"]),h=d3.scale.linear().domain([0,d3.max(c)]).range([0,e]),i=d3.scale.ordinal().domain(d3.range(0,c.length)).rangeBands([0,f],.2),j=d3.select("body").append("div").style("position","absolute").style("padding","0 10px").style("background","white").style("opacity",0),k=d3.select("#chart_d3").append("svg").style("background","#E9E9E9").attr("width",f+d.left+d.right).attr("height",e+d.top+d.bottom).append("g").attr("transform","translate("+d.left+", "+d.top+")").selectAll("rect").data(c).enter().append("rect").style("fill",function(a,b){return g(b)}).attr("width",i.rangeBand()).attr("x",function(a,b){return i(b)}).attr("height",0).attr("y",e).on("mouseover",function(a){j.transition().style("opacity",.9),j.html(a).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-30+"px"),b=this.style.fill,d3.select(this).style("opacity",.5).style("fill","yellow")}).on("mouseout",function(a){d3.select(this).style("opacity",1).style("fill",b)});k.transition().attr("height",function(a){return h(a)}).attr("y",function(a){return e-h(a)}).delay(function(a,b){return 40*b}).duration(1e3).ease("elastic");var l=d3.scale.linear().domain([0,d3.max(c)]).range([e,0]),m=d3.svg.axis().scale(l).orient("left").ticks(10),n=d3.select("svg").append("g");m(n),n.attr("transform","translate("+d.left+", "+d.top+")"),n.selectAll("path").style({fill:"none",stroke:"#000"}),n.selectAll("line").style({stroke:"#000"});var o=d3.svg.axis().scale(i).orient("bottom").tickValues(i.domain().filter(function(a,b){return!(b%(c.length/5))})),p=d3.select("svg").append("g");o(p),p.attr("transform","translate("+d.left+", "+(e+d.top)+")"),p.selectAll("path").style({fill:"none",stroke:"#000"}),p.selectAll("line").style({stroke:"#000"})};return a.init=function(a){$.ajax({url:router.host+"/games/"+a,type:"GET",dataType:"JSON"}).done(function(a){console.log(a),b(a)}).fail(function(a,b,c){console.log(a,b,c)})},a}(showGame||{}),allPlayers=function(a){var b=function(a){var b=Handlebars.compile($("#all_players_template").html());$("#content2").html(b({players:a}))};return a.init=function(){$.ajax({url:router.host+"/players",type:"GET",dataType:"JSON"}).done(function(a){console.log(a),b(a)}).fail(function(a,b,c){console.log(a,b,c)})},a}(allPlayers||{}),allGames=function(a){var b=function(a){var b=Handlebars.compile($("#all_games_template").html());$("#content1").html(b({games:a}))},c=function(){$.ajax({url:router.host+"/games",type:"GET",dataType:"JSON"}).done(function(a){b(a)}).fail(function(a,b,c){console.log(a,b,c)})};return a.init=function(){c()},a}(allGames||{}),newGame=function(a){var b=function(a){var b=Handlebars.compile($("#new_game_template").html());$("#content2").html(b({players:a})),$("form#submit-new-game").on("click",function(a){a.preventDefault(),c(a),alert("CLICKED")})},c=function(a){$.ajax({url:router.host+"/games",type:"POST",dataType:"JSON",data:{game:{name:$("input#new-game-name").val(),status:"active",start_date:"Apr 1 2015"}}}).done(function(a){console.log(a)}).fail(function(a,b,c){console.log(a,b,c)})},d=function(){$.ajax({url:router.host+"/players",type:"GET",dataType:"JSON"}).done(function(a){console.log(a),b(a)}).fail(function(a,b,c){console.log(a,b,c)})};return a.init=function(){d()},a}(newGame||{});